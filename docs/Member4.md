기능

1. 타워 설치시 위치 동기화
2. 타워 합성
3. 타워 강화
4. 몬스터 처치 시 골드 동기화
5. 타워 설치, 강화시 골드 동기화


트러블슈팅

몬스터 처치시 골드 획득 기능을 만드는 과정에서 순환 참조 문제가 생겼다.
monsterSpawner.js에서 socket.js를 참조할 때 생기는 문제였다.
서버에서 몬스터가 죽었다는 정보를 처리하는 과정에서 클라이언트로 메시지를 보냈는데, monsterSpawner.js에서 해당 메시지를 처리하도록 되어있었다.
서버에서 받은 골드 정보가 나의 골드 정보인지를 확인하려면 socket.js에 선언되어있는 userId를 참조해야했다.

서버에서 몬스터가 죽었다는 정보를 처리하는 과정에서, 몬스터의 식별 정보와 해당 유저들의 골드 정보를 전달하는 방법을, 몬스터의 식별정보를 한 메시지로, 해당 유저들의 골드 정보를 다른 메시지로 보내는, 총 두개의 메시지를 보내는 방법으로 바꾸었다. 그리고 몬스터의 식별 정보는 기존대로 monsterSpawner.js에서 처리하고, 유저들의 골드 정보는 socket.js에서 직접 처리하도록 했다. 결과적으로 monsterSpawner.js에서 socket.js를 참조하지 않게 되었고, 문제없이 처리되었다.

문제는 해결했지만 원인을 알 수 없어서 답답한 상황이었다.


후기

 처음엔 다른사람이 만들어놓은 타워 코드 위에 합성과 강화 코드만 얹어서 편하게 작업할 수 있을거라고 생각했다. 그런데 생각외로 타워 설치 동기화와 골드 동기화까지 작업하게 됐다.
 클라이언트에서 서버 메시지를 처리하는 핸들러를 모두 socket.js에서 처리하면 위의 순환참조 문제가 없었을거라 생각한다. 몬스터 관련 코드는 내가 작업한게 아니라서 왜 파일구조가 이렇게 됐는지는 모르겠지만 아쉬운 부분이다.
 